{% extends 'layout.html' %}
{% block title %}{{ 'แก้ไขข้อมูลลูกค้า' if customer else 'เพิ่มลูกค้า' }}{% endblock %}
{% block content %}
<div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">
        {{ 'แก้ไขข้อมูลลูกค้า' if customer else 'เพิ่มลูกค้าใหม่' }}
    </h1>

    {% if error %}
    <div class="mb-4 p-3 bg-red-100 text-red-700 border border-red-300 rounded">
        {{ error }}
    </div>
    {% endif %}

    <form method="post" class="space-y-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- ข้อมูลพื้นฐาน -->
        <div>
            <label class="block font-medium mb-1">ชื่อ</label>
            <input type="text" name="first_name" required
                   class="w-full border rounded px-3 py-2"
                   value="{{ customer.first_name if customer else (form_data.first_name if form_data else '') }}">
        </div>

        <div>
            <label class="block font-medium mb-1">นามสกุล</label>
            <input type="text" name="last_name" required
                   class="w-full border rounded px-3 py-2"
                   value="{{ customer.last_name if customer else (form_data.last_name if form_data else '') }}">
        </div>

        <div>
            <label class="block font-medium mb-1">เพศ</label>
            <select name="gender" required class="w-full border rounded px-3 py-2">
                <option value="">เลือกเพศ</option>
                <option value="ชาย" {% if (customer and customer.gender == 'ชาย') or (form_data and form_data.gender == 'ชาย') %}selected{% endif %}>ชาย</option>
                <option value="หญิง" {% if (customer and customer.gender == 'หญิง') or (form_data and form_data.gender == 'หญิง') %}selected{% endif %}>หญิง</option>
                <option value="ไม่ระบุ" {% if (customer and customer.gender == 'ไม่ระบุ') or (form_data and form_data.gender == 'ไม่ระบุ') %}selected{% endif %}>ไม่ระบุ</option>
            </select>
        </div>

        <div>
            <label class="block font-medium mb-1">วันเกิด</label>
            <input type="date" name="birthdate" required
                   class="w-full border rounded px-3 py-2"
                   value="{{ customer.birthdate if customer else (form_data.birthdate if form_data else '') }}">
        </div>

        <div>
            <label class="block font-medium mb-1">เบอร์โทรศัพท์</label>
            <input type="text" name="phone" required
                   class="w-full border rounded px-3 py-2"
                   value="{{ customer.phone if customer else (form_data.phone if form_data else '') }}">
        </div>

        <div>
            <label class="block font-medium mb-1">อีเมล</label>
            <input type="email" name="email" required
                   class="w-full border rounded px-3 py-2"
                   value="{{ customer.email if customer else (form_data.email if form_data else '') }}">
        </div>

        <!-- ที่อยู่ -->
        <div>
            <label class="block font-medium mb-1">บ้านเลขที่</label>
            <input type="text" name="address_no"
                   class="w-full border rounded px-3 py-2"
                   value="{{ address.address_no if address else '' }}">
        </div>

        <div>
            <label class="block font-medium mb-1">หมู่บ้าน/อาคาร</label>
            <input type="text" name="village"
                   class="w-full border rounded px-3 py-2"
                   value="{{ address.village if address else '' }}">
        </div>

        <div>
            <label class="block font-medium mb-1">ถนน</label>
            <input type="text" name="road"
                   class="w-full border rounded px-3 py-2"
                   value="{{ address.road if address else '' }}">
        </div>

        <div class="flex flex-row gap-2 mb-4">
            <div class="flex-1">
                <label class="block font-medium mb-1">จังหวัด</label>
                <select name="province" id="provinceSelect" class="w-full border rounded px-3 py-2">
                    <option value="">-- เลือกจังหวัด --</option>
                    {% for p in provinces %}
                      <option value="{{ p }}" {% if address and address.province == p %}selected{% endif %}>{{ p }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex-1">
                <label class="block font-medium mb-1">อำเภอ/เขต</label>
                <select name="district" id="districtSelect" class="w-full border rounded px-3 py-2">
                    <option value="">-- เลือกอำเภอ/เขต --</option>
                    {% if address and address.district %}
                      <option value="{{ address.district }}" selected>{{ address.district }}</option>
                    {% endif %}
                </select>
            </div>
            <div class="flex-1">
                <label class="block font-medium mb-1">ตำบล/แขวง</label>
                <select name="subdistrict" id="subdistrictSelect" class="w-full border rounded px-3 py-2">
                    <option value="">-- เลือกตำบล/แขวง --</option>
                    {% if address and address.subdistrict %}
                      <option value="{{ address.subdistrict }}" selected>{{ address.subdistrict }}</option>
                    {% endif %}
                </select>
            </div>
        </div>

        <div>
            <label class="block font-medium mb-1">รหัสไปรษณีย์</label>
            <select name="zipcode" id="zipcodeSelect" class="w-full border rounded px-3 py-2">
                <option value="">-- เลือกรหัสไปรษณีย์ --</option>
                {% if address and address.zipcode %}
                  <option value="{{ address.zipcode }}" selected>{{ address.zipcode }}</option>
                {% endif %}
            </select>
        </div>

        <!-- ปุ่ม -->
        <div class="flex justify-end">
            <a href="{{ url_for('admin.customer_list') }}"
               class="mr-4 px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">ยกเลิก</a>
            <button type="submit"
                    class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
                {{ 'บันทึกข้อมูล' if customer else 'เพิ่มลูกค้า' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}
